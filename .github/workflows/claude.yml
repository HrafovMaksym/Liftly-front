name: Claude PR Assistant

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

jobs:
  claude:
    runs-on: ubuntu-latest
    # Only trigger on @claude mentions
    if: |
      contains(github.event.comment.body, '@claude')
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude PR Assistant
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}

          claude_args: |
            --max-turns 10
            --model claude-sonnet-4-5-20250929

          # Claude reads CLAUDE.md automatically from repo root
          # Interactive mode: responds to @claude mentions
          # Examples users can write in PR comments:
          #   @claude review this file for security issues
          #   @claude explain what this function does
          #   @claude suggest better naming for these variables
          #   @claude fix the TypeScript errors
          #   @claude add Swagger decorators to this controller
          #   @claude refactor this to follow FSD rules
          #   @claude write unit tests for this service
          #   @claude check if this follows our coding standards
